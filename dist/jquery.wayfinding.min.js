/*! wayfinding - v0.4.0 - 2016-06-02
* https://github.com//wayfinding
* Copyright (c) 2016 Regents of the University of California Licensed MIT */
!function(a){"use strict";var b,c={maps:[{path:"floorplan.svg",id:"map.1"}],path:{color:"red",radius:10,speed:8,width:3},startpoint:function(){return"startpoint"},endpoint:!1,accessibleRoute:!1,defaultMap:function(){return"map.1"},loadMessage:"Loading",dataStoreCache:null,showLocation:!1,locationIndicator:{fill:"red",height:40},pinchToZoom:!1,zoomToRoute:!0,zoomPadding:25,floorChangeAnimationDelay:1250,emscriptenBackend:!0};a.fn.wayfinding=function(d,e,f){function g(a){return a.replace(/(:|\.|\[|\])/g,"\\$1")}function h(a,b,c,d){return(d-c)/d*a+c/d*b}function i(a){this.value=a,this.message=" no maps identified in collection to load",this.toString=function(){return this.value+this.message}}function j(a){this.value=a,this.message=" has duplicate map ids",this.toString=function(){return this.value+this.message}}function k(a){this.value=a,this.message=" wasn't in the list of maps",this.toString=function(){return this.value+this.message}}function l(b){var c,d,f,g=!1,h=!1;if(f=a(b).find("div").hide().end().append('<div id="WayfindingStatus" style="">'+e.loadMessage+"</div>"),!(W.length>0))throw a(f).text(e.errorMessage),new i(JSON.stringify(W));for(c=0;c<W.length;c++)for(d=c;d<W.length;d++)c!==d&&W[c].id===W[d].id&&(g=!0);if(g===!0)throw a(f).text(e.errorMessage),new j(JSON.stringify(W));for(c=0;c<W.length;c++)W[c].id===X&&(h=!0);if(h===!1)throw a(f).text(e.errorMessage),new k(X)}function m(b,c,d){var f,g,h,i,j=e.locationIndicator.height;return f=document.createElementNS("http://www.w3.org/2000/svg","g"),a(f).attr("class",d),g=document.createElementNS("http://www.w3.org/2000/svg","path"),h=document.createElementNS("http://www.w3.org/2000/svg","circle"),i="M0.075,0",i+="c-2.079-10.207-5.745-18.703-10.186-26.576c-3.295-5.84-7.111-11.23-10.642-16.894c-1.179-1.891-2.196-3.888-3.327-5.85",i+="c-2.266-3.924-4.102-8.472-3.984-14.372c0.113-5.766,1.781-10.391,4.186-14.172c3.954-6.219,10.578-11.317,19.465-12.657",i+="c7.268-1.095,14.08,0.756,18.911,3.58c3.948,2.31,7.005,5.394,9.329,9.027c2.426,3.793,4.096,8.274,4.236,14.12",i+="c0.072,2.995-0.418,5.769-1.109,8.069c-0.699,2.328-1.823,4.274-2.824,6.353c-1.953,4.06-4.4,7.777-6.857,11.498",i+="C9.954,-26.789,3.083,-15.486,0.075,0z",g.setAttribute("d",i),g.setAttribute("fill","#E81E25"),g.setAttribute("stroke","#000000"),g.setAttribute("stroke-width","3.7"),g.setAttribute("stroke-miterlimit","10"),h.setAttribute("cx","0"),h.setAttribute("cy","-63.757"),h.setAttribute("r","9.834"),f.appendChild(g),f.appendChild(h),f.setAttribute("transform","translate("+b+" "+(c-10*(j/125))+") scale("+j/125+")"),f}function n(c,d,e){var f,g,h,i,j,k,l,m,n;b.p[c]=[],a("#Paths line",e).each(function(){f={},f.floor=d.id,f.r=1/0,f.p=-1,f.x=a(this).attr("x1"),f.y=a(this).attr("y1"),f.d=[],f.m=a(this).attr("x2"),f.n=a(this).attr("y2"),f.e=[],f.l=Math.sqrt(Math.pow(f.x-f.m,2)+Math.pow(f.y-f.n,2)),f.c=[],f.q=[],b.p[c].push(f)}),a("#Doors line",e).each(function(){h=a(this).attr("x1"),i=a(this).attr("y1"),j=a(this).attr("x2"),k=a(this).attr("y2"),g=a(this).attr("id"),a.each(b.p[c],function(a,b){d.id===b.floor&&(b.x===h&&b.y===i||b.x===j&&b.y===k)?b.d.push(g):d.id===b.floor&&(b.m===h&&b.n===i||b.m===j&&b.n===k)&&b.e.push(g)})}),a("#Portals line",e).each(function(){m={},n=a(this).attr("id"),n&&n.indexOf("_")>-1&&(n=n.slice(0,n.indexOf("_"))),m.id=n,m.type=n.split(".")[0],m.floor=d.id,m.mate=n.split(".").slice(0,2).join(".")+"."+d.id,m.mapNum=c,m.matched=!1,h=a(this).attr("x1"),i=a(this).attr("y1"),j=a(this).attr("x2"),k=a(this).attr("y2"),l=a.grep(b.p[c],function(a){return h===a.x&&i===a.y||h===a.m&&i===a.n}),0!==l.length?(m.x=h,m.y=i):(m.x=j,m.y=k),m.l=Math.sqrt(Math.pow(h-j,2)+Math.pow(i-k,2)),ca.push(m)})}function o(){var a,c,d,e,f,g,h,i,j,k;for(a=0;a<ca.length;a++)if(d=ca[a],d.matched===!1)for(c=a;c<ca.length;c++)ca[c].id===d.mate&&ca[c].mate===d.id&&(e=ca[c],f={},d.matched=!0,e.matched=!0,f.t=d.type,f.a="Elev"===f.t||"Door"===f.t?!0:!1,f.f=d.floor,f.g=d.mapNum,f.x=d.x,f.y=d.y,f.c=[],f.j=e.floor,f.k=e.mapNum,f.m=e.x,f.n=e.y,f.d=[],f.l=d.l+e.l,f.r=1/0,f.p=-1,b.q.push(f));for(g=0;g<W.length;g++)for(h=0;h<b.p[g].length-1;h++)for(i=h+1;i<b.p[g].length;i++)(b.p[g][i].x===b.p[g][h].x&&b.p[g][i].y===b.p[g][h].y||b.p[g][i].m===b.p[g][h].x&&b.p[g][i].n===b.p[g][h].y||b.p[g][i].x===b.p[g][h].m&&b.p[g][i].y===b.p[g][h].n||b.p[g][i].m===b.p[g][h].m&&b.p[g][i].n===b.p[g][h].n)&&(b.p[g][h].c.push(i),b.p[g][i].c.push(h));for(j=0;j<b.q.length;j++)for(g=0;g<W.length;g++)for(k=0;k<b.p[g].length;k++)b.q[j].f===b.p[g][k].floor&&(b.q[j].x===b.p[g][k].x&&b.q[j].y===b.p[g][k].y||b.q[j].x===b.p[g][k].m&&b.q[j].y===b.p[g][k].n)?(b.q[j].c.push(k),b.p[g][k].q.push(j)):b.q[j].j===b.p[g][k].floor&&(b.q[j].m===b.p[g][k].x&&b.q[j].n===b.p[g][k].y||b.q[j].m===b.p[g][k].m&&b.q[j].n===b.p[g][k].n)&&(b.q[j].d.push(k),b.p[g][k].q.push(j));ca=[]}function p(a){var c,d,e,f,g={paths:[],floor:null};for(c=0;c<W.length;c++)for(d=0;d<b.p[c].length;d++){for(e=0;e<b.p[c][d].d.length;e++)b.p[c][d].d[e]===a&&(g.paths.push(d),g.floor=b.p[c][d].floor);for(f=0;f<b.p[c][d].e.length;f++)b.p[c][d].e[f]===a&&(g.paths.push(d),g.floor=b.p[c][d].floor)}return g}function q(c,d,f,g){a.each(b.p[d][f].c,function(a,e){g+b.p[d][e].l<b.p[d][e].r&&(b.p[d][e].r=g+b.p[d][e].l,b.p[d][e].p=f,b.p[d][e].o=c,q("pa",d,e,b.p[d][e].r))}),b.p[d][f].q.length>0&&a.each(b.p[d][f].q,function(h,i){g+b.q[i].l<b.q[i].r&&(e.accessibleRoute===!1||e.accessibleRoute===!0&&b.q[i].a)&&(b.q[i].r=g+b.q[i].l,b.q[i].p=f,b.q[i].q=d,b.q[i].o=c,-1!==a.inArray(f,b.q[i].c)?a.each(b.q[i].d,function(a,c){g+b.q[i].l+b.p[b.q[i].k][c].l<b.p[b.q[i].k][c].r&&(b.p[b.q[i].k][c].r=b.q[i].r+b.p[b.q[i].k][c].l,b.p[b.q[i].k][c].p=i,b.p[b.q[i].k][c].o="po",q("pa",b.q[i].k,c,b.p[b.q[i].k][c].r))}):a.each(b.q[i].c,function(a,c){g+b.q[i].l+b.p[b.q[i].g][c].l<b.p[b.q[i].g][c].r&&(b.p[b.q[i].g][c].r=b.q[i].r+b.p[b.q[i].g][c].l,b.p[b.q[i].g][c].p=i,b.p[b.q[i].g][c].o="po",q("pa",b.q[i].g,c,b.p[b.q[i].g][c].r))}))})}function r(){var c,d,e;for(c=p(Y),d=0;d<W.length;d++)if(W[d].id===c.floor){e=d;break}a.each(c.paths,function(a,c){b.p[e][c].r=b.p[e][c].l,b.p[e][c].p="door",q("pa",e,c,b.p[e][c].l)})}function s(a,c,d){var e;if("door"!==d)switch(e={},e.type=a,e.floor=c,e.segment=d,Z.push(e),a){case"pa":s(b.p[c][d].o,c,b.p[c][d].p);break;case"po":s(b.q[d].o,b.q[d].q,b.q[d].p)}}function t(){var a,c,d,f,g,h;for(a=p(e.endpoint),c=0;c<W.length;c++)if(W[c].id===a.floor){d=c;break}for(g=1/0,f=-1,h=0;h<a.paths.length;h++)b.p[d][a.paths[h]].r<g&&(g=b.p[d][a.paths[h]].r,f=a.paths[h]);return-1!==f&&(Z=[],s("pa",d,f),Z.reverse()),Z}function u(){return b={p:[],q:[]},ca=[],a.each(W,function(a,b){n(a,b,b.el)}),o(),r(),b}function v(a,b){return a.x!==b.x?a.x-b.x:a.y!==b.y?a.y-b.y:a.id-b.id}function w(c,d){b.doors[c]=[],a("#Doors line",d).each(function(){var d={};d.floor=c,d.x1=parseInt(a(this).attr("x1")),d.x1Float=parseFloat(a(this).attr("x1")),d.y1=parseInt(a(this).attr("y1")),d.y1Float=parseFloat(a(this).attr("y1")),d.x2=parseInt(a(this).attr("x2")),d.x2Float=parseFloat(a(this).attr("x2")),d.y2=parseInt(a(this).attr("y2")),d.y2Float=parseFloat(a(this).attr("y2")),d.doorId=a(this).attr("id").split("_")[0],d.id=b.doors[c].length,d.paths=[],d.doors=[],d.portals=[],b.doors[c].push(d),aa.queue({x:d.x1,y:d.y1,id:b.doors[c].length-1,type:"doors"}),aa.queue({x:d.x2,y:d.y2,id:b.doors[c].length-1,type:"doors"})})}function x(c,d){b.paths[c]=[],a("#Paths line",d).each(function(){var d={};d.floor=c,d.x1=parseInt(a(this).attr("x1")),d.x1Float=parseFloat(a(this).attr("x1")),d.y1=parseInt(a(this).attr("y1")),d.y1Float=parseFloat(a(this).attr("y1")),d.x2=parseInt(a(this).attr("x2")),d.x2Float=parseFloat(a(this).attr("x2")),d.y2=parseInt(a(this).attr("y2")),d.y2Float=parseFloat(a(this).attr("y2")),d.length=Math.sqrt(Math.pow(d.x2Float-d.x1Float,2)+Math.pow(d.y2Float-d.y1Float,2)),d.pathId=b.paths[c].length,d.id=b.paths[c].length,d.paths=[],d.doors=[],d.portals=[],b.paths[c].push(d),aa.queue({x:d.x1,y:d.y1,id:b.paths[c].length-1,type:"paths"}),aa.queue({x:d.x2,y:d.y2,id:b.paths[c].length-1,type:"paths"})})}function y(c,d){b.portals[c]=[],a("#Portals line",d).each(function(){var d={};d.floor=c,d.x1=parseInt(a(this).attr("x1")),d.x1Float=parseFloat(a(this).attr("x1")),d.y1=parseInt(a(this).attr("y1")),d.y1Float=parseFloat(a(this).attr("y1")),d.x2=parseInt(a(this).attr("x2")),d.x2Float=parseFloat(a(this).attr("x2")),d.y2=parseInt(a(this).attr("y2")),d.y2Float=parseFloat(a(this).attr("y2")),d.paths=[],d.doors=[],d.portals=[],d.id=b.portals[c].length;var e=a(this).attr("id").split("_")[0].split(".");d.portalId=e[0]+"."+e[1];var f=da[e[2]];void 0===f&&(f=-1),d.toFloor=parseInt(f),d.accessible=!1,d.match=-1,"Elev"===e[0]&&(d.accessible=!0),d.length=Math.sqrt(Math.pow(d.x2Float-d.x1Float,2)+Math.pow(d.y2Float-d.y1Float,2)),b.portals[c].push(d),aa.queue({x:d.x1,y:d.y1,id:b.portals[c].length-1,type:"portals"}),aa.queue({x:d.x2,y:d.y2,id:b.portals[c].length-1,type:"portals"})})}function z(c){function d(c,d){a.each(c,function(e,f){a.each(c,function(a,c){e!==a&&b[f.type][d][f.id][c.type].push(c.id)})})}if(0!==aa.length){for(var e=aa.dequeue(),f=[e],g=e;aa.length>0;){var h=aa.dequeue();g.x===h.x&&g.y===h.y?f.push(h):(d(f,c),f=[h]),g=h}d(f,c)}}function A(){a.each(b.portals,function(c,d){a.each(d,function(c,d){-1===d.match&&-1!==d.toFloor&&a.each(b.portals[d.toFloor],function(a,b){b.portalId===d.portalId&&b.toFloor===d.floor&&(d.match=b.id,b.match=d.id)})})})}function B(){return b={doors:[],paths:[],portals:[]},a.each(W,function(a,b){aa=new PriorityQueue({comparator:v}),w(a,b.el),x(a,b.el),y(a,b.el),z(a)}),A(),b}function C(){return e.emscriptenBackend?B():u()}function D(c){if(e.dataStoreCache){if("object"==typeof e.dataStoreCache)b=e.dataStoreCache,"function"==typeof c&&c();else if("string"==typeof e.dataStoreCache){var d=e.dataStoreCache+Y+(e.accessibleRoute?".acc":"")+".json";a.getJSON(d,function(a){b=a,"function"==typeof c&&c()}).fail(function(){b=C(),"function"==typeof c&&c()})}}else b=C(),"function"==typeof c&&c()}function E(b,c){var d,f,h,i,j;if(a("g.startPin",c).remove(),e.startpoint=b,Y="function"==typeof e.startpoint?e.startpoint():e.startpoint,e.showLocation){d=a("#Doors #"+g(Y),c);var k=c.children().has(a("#"+g(Y)));if(f=a("svg",k).children().last(),!d.length)return;h=(Number(d.attr("x1"))+Number(d.attr("x2")))/2,i=(Number(d.attr("y1"))+Number(d.attr("y2")))/2,j=m(h,i,"startPin"),f.after(j)}}function F(b,c){var d,f,h,i,j;if(a("g.destinationPin",c).remove(),e.showLocation){if(d=a("#Doors #"+g(b),c),f=a("svg").has('#Rooms a[id="'+g(b)+'"]'),!d.length)return;h=(Number(d.attr("x1"))+Number(d.attr("x2")))/2,i=(Number(d.attr("y1"))+Number(d.attr("y2")))/2,j=m(h,i,"destinationPin"),f.append(j)}}function G(b){var d=b.data("wayfinding:options");_=b.data("wayfinding:drawing"),e=a.extend(!0,{},c,e),e=void 0!==d?d:a.extend(!0,{},c,e),e=a.metadata?a.extend(!0,{},e,b.metadata()):e,W=e.maps,X="function"==typeof e.defaultMap?e.defaultMap():e.defaultMap,Y="function"==typeof e.startpoint?e.startpoint():e.startpoint}function H(a){a.data("wayfinding:options",e),a.data("wayfinding:drawing",_),a.data("wayfinding:data",b)}function I(b){var c=a(b).find("svg"),d=parseInt(a(c).attr("height").replace("px","").split(".")[0],10),e=parseInt(a(c).attr("width").replace("px","").split(".")[0],10);d=2*Math.ceil(d/2),e=2*Math.ceil(e/2),a(b).css("padding-bottom",100*(d/e)+"%"),c.attr("height","100%").attr("width","100%").attr("preserveAspectRatio","xMinYMin meet"),a("#Rooms a, #Doors line",b).each(function(){if(a(this).prop("id")&&a(this).prop("id").indexOf("_")>0){var b=a(this).prop("id");a(this).prop("id",b.slice(0,b.indexOf("_")))}})}function J(a){a.panzoom({minScale:1,contain:"invert",cursor:"pointer"}),a.find("a").on("mousedown touchstart",function(a){a.stopImmediatePropagation()})}function K(b,c){a(c).hide(),a("#Paths line",c).attr("stroke-opacity",0),a("#Doors line",c).attr("stroke-opacity",0),a("#Portals line",c).attr("stroke-opacity",0);var d=a("#Paths",c).parent();d.is("g")&&d.attr("opacity",0).attr("display","inline"),a("#Rooms a",c).click(function(c){a(b).trigger("wayfinding:roomClicked",[{roomId:a(this).attr("id")}]),a(b).wayfinding("routeTo",a(this).prop("id")),c.preventDefault()}),a(c).find("*").css("pointer-events","none"),a("#Rooms a",c).find("*").css("pointer-events","auto"),a(b).append(c),e.pinchToZoom&&J(a(c))}function L(b,c){var d=a(c).height();a(c).height(d),a("div",c).hide(),a("#"+b,c).show(0,function(){a(c).trigger("wayfinding:floorChanged",{mapId:b})});var f,g,h,i;if(_){for(h=-1,f=0;f<W.length;f++)if(W[f]===b){h=f;break}for(g=-1,f=0;f<_.length;f++)if(_[f].floor===h){g=f;break}-1!==g&&(i=_[g].routeLength,a(_[g].path,c).attr("stroke-dasharray",[i,i]),a(_[g].path,c).attr("stroke-dashoffset",i),a(_[g].path,c).attr("pathLength",i),a(_[g].path,c).attr("stroke-dashoffset",i),a(_[g].path,c).animate({svgStrokeDashOffset:0},i*e.path.speed))}}function M(b){a("path[class^=directionPath]",b).css({stroke:"none"})}function N(b,c,d,e,f,g){d=parseFloat(d),e=parseFloat(e),f=parseFloat(f),g=parseFloat(g);var h=c.getAttribute("viewBox"),i=parseFloat(h.split(/\s+|,/)[0]),j=parseFloat(h.split(/\s+|,/)[1]),k=parseFloat(h.split(/\s+|,/)[2]),l=parseFloat(h.split(/\s+|,/)[3]),m=a(b).width(),n=a(b).height(),o=Math.min(k/f,l/g);a(b).panzoom("zoom",parseFloat(o));var p=m/k,q=n/l,r=i+k/2,s=j+l/2,t=(r-(d+f/2))*p,u=(s-(e+g/2))*q;a(b).panzoom("pan",t*o,u*o)}function O(b){function c(b,c,d,f,i){setTimeout(function(){var i={};i.X=h(c.X,d.X,b,f),i.Y=h(c.Y,d.Y,b,f),i.W=h(c.W,d.W,b,f),i.H=h(c.H,d.H,b,f),e.pinchToZoom?N(a(g).parent()[0],g,i.X,i.Y,i.W,i.H):g.setAttribute("viewBox",i.X+" "+i.Y+" "+i.W+" "+i.H)},b*(i/f))}function d(c,d,f,i,j){setTimeout(function(){var j={};j.X=h(f.X,d.X,c,i),j.Y=h(f.Y,d.Y,c,i),j.W=h(f.W,d.W,c,i),j.H=h(f.H,d.H,c,i),e.pinchToZoom?N(a(g).parent()[0],g,j.X,j.Y,j.W,j.H):g.setAttribute("viewBox",j.X+" "+j.Y+" "+j.W+" "+j.H),c===i&&b===_.length&&a(V).trigger("wayfinding:animationComplete")},c*(j/i))}var f,g,i,j,k,l,m,n=e.zoomPadding,o=35,p=650,q={},r={};if(e.repeat&&b>=_.length)setTimeout(function(){O(0)},5e3);else if(b>=_.length)return;var s=_[b][0].floor;if(g=a("#"+W[s].id+" svg")[0],j=_[b].routeLength,l=j*e.path.speed,L(W[_[b][0].floor].id,V),f=a("#"+W[_[b][0].floor].id+" .directionPath"+b)[0],f.style.stroke=e.path.color,f.style.strokeWidth=e.path.width,f.style.transition=f.style.WebkitTransition="none",f.style.strokeDasharray=j+" "+j,f.style.strokeDashoffset=j,i=f.getBBox(),f.style.transition=f.style.WebkitTransition="stroke-dashoffset "+l+"ms linear",f.style.strokeDashoffset="0",e.zoomToRoute===!1)b===_.length-1&&a(f).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){a(V).trigger("wayfinding:animationComplete")});else for(k=g.getAttribute("viewBox"),q.X=parseFloat(k.split(/\s+|,/)[0]),q.Y=parseFloat(k.split(/\s+|,/)[1]),q.W=parseFloat(k.split(/\s+|,/)[2]),q.H=parseFloat(k.split(/\s+|,/)[3]),r.X=i.x-n>0?i.x-n:0,r.Y=i.y-n>0?i.y-n:0,r.H=i.height+2*n,r.W=i.width+2*n,m=0;o>=m;m++)c(m,q,r,o,p);setTimeout(function(){if(O(++b),e.zoomToRoute)for(m=1===_.length||_.length>1&&b===_.length?0:o;o>=m;m++)d(m,q,r,o,p)},l+e.floorChangeAnimationDelay)}function P(a,c){var d=b[a.type][a.floor][a.segment],e=b[c.type][c.floor][c.segment];return e.x1===d.x1&&e.y1===d.y1||e.x1===d.x2&&e.y1===d.y2?!0:!1}function Q(c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,u,v,w,x,y,z,A,B,C,D;if(e.endpoint=c,a("path[class^=directionPath]",V).remove(),a("#Rooms *.wayfindingRoom",V).removeAttr("class"),Z=[],Y!==c&&(a('#Rooms a[id="'+c+'"] g',V).attr("class","wayfindingRoom"),F(e.endpoint,d),Z=t(),-1!==j)){for(k=0,f=0;f<Z.length;f++)"po"===Z[f].type&&k++;if(_=new Array(k),_[0]=[],g={},0===Z.length)return void console.warn("Attempting to route with no solution. This should never happen. SVG likely has errors. Destination is: "+c);for(b.p[Z[0].floor][Z[0].segment].d[0]===Y?(g={},g.floor=Z[0].floor,g.type="M",g.x=b.p[Z[0].floor][Z[0].segment].x,g.y=b.p[Z[0].floor][Z[0].segment].y,g.length=0,_[0].push(g),g={},g.type="L",g.floor=Z[0].floor,g.x=b.p[Z[0].floor][Z[0].segment].m,g.y=b.p[Z[0].floor][Z[0].segment].n,g.length=b.p[Z[0].floor][Z[0].segment].l,_[0].push(g),_[0].routeLength=g.length):b.p[Z[0].floor][Z[0].segment].e[0]===Y&&(g={},g.type="M",g.floor=Z[0].floor,g.x=b.p[Z[0].floor][Z[0].segment].m,g.y=b.p[Z[0].floor][Z[0].segment].n,g.length=0,_[0].push(g),g={},g.type="L",g.floor=Z[0].floor,g.x=b.p[Z[0].floor][Z[0].segment].x,g.y=b.p[Z[0].floor][Z[0].segment].y,g.length=b.p[Z[0].floor][Z[0].segment].l,_[0].push(g),_[0].routeLength=g.length),l=1,f=0;k+1>f;f++)for(h=l;h<Z.length;h++)"pa"===Z[h].type&&(m=b.p[Z[h].floor][Z[h].segment].x,n=b.p[Z[h].floor][Z[h].segment].y,o=b.p[Z[h].floor][Z[h].segment].m,p=b.p[Z[h].floor][Z[h].segment].n,g={},g.floor=Z[h].floor,_[f].slice(-1)[0].x===m&&_[f].slice(-1)[0].y===n?(g.x=o,g.y=p):(g.x=m,g.y=n),g.length=b.p[Z[h].floor][Z[h].segment].l,g.type="L",_[f].push(g),_[f].routeLength+=g.length),"po"===Z[h].type&&(_[f+1]=[],_[f+1].routeLength=0,D="",b.q[Z[h].segment].g===b.q[Z[h].segment].k?D=b.q[Z[h].segment].x===g.x&&b.q[Z[h].segment].y===g.y?"B":"A":b.q[Z[h].segment].g===Z[h].floor?D="A":b.q[Z[h].segment].k===Z[h].floor&&(D="B"),"A"===D?(g={},g.floor=Z[h].floor,g.type="M",g.x=b.q[Z[h].segment].x,g.y=b.q[Z[h].segment].y,g.length=0,_[f+1].push(g),_[f+1].routeLength=g.length):"B"===D&&(g={},g.floor=Z[h].floor,g.type="M",g.x=b.q[Z[h].segment].m,g.y=b.q[Z[h].segment].n,g.length=0,_[f+1].push(g),_[f+1].routeLength=g.length),l=h,l++,h=Z.length);if(e.path.radius>0)for(i=0;i<_.length;i++){for(f=1;f<_[i].length-1;f++)"L"===_[i][f].type&&"L"===_[i][f].type&&(q=_[i][f-1].x-_[i][f].x,r=_[i][f-1].y-_[i][f].y,s=_[i][f].x-_[i][f+1].x,u=_[i][f].y-_[i][f+1].y,(0===r&&0===u||0===q&&0===s||q/r===s/u&&(0!==q||0!==r||0!==s||0!==u))&&(_[i][f+1].length=_[i][f].length+_[i][f+1].length,_[i].splice(f,1),f=1));for(f=1;f<_[i].length-1;f++)"L"===_[i][f].type&&"L"===_[i][f].type&&_[i][f].length>e.path.radius&&_[i][f+1].length>e.path.radius&&(v=_[i][f].x,w=_[i][f].y,x=_[i][f-1].x,y=_[i][f-1].y,_[i][f].x=Number(x)+(v-x)*((_[i][f].length-e.path.radius)/_[i][f].length),_[i][f].y=Number(y)+(w-y)*((_[i][f].length-e.path.radius)/_[i][f].length),_[i][f].length=_[i][f].length-e.path.radius,z={},z.cx=v,z.cy=w,A=_[i][f+1].x,B=_[i][f+1].y,z.x=Number(v)+(A-v)*(e.path.radius/_[i][f+1].length),z.y=Number(w)+(B-w)*(e.path.radius/_[i][f+1].length),_[i][f+1].length=_[i][f+1].length-e.path.radius,z.type="Q",z.floor=_[i][f].floor,_[i].splice(f+1,0,z))}a.each(_,function(b,c){var d,e="";a.each(c,function(a,b){switch(b.type){case"M":e="M"+b.x+","+b.y;break;case"L":e+="L"+b.x+","+b.y;break;case"Q":e+="Q"+b.cx+","+b.cy+" "+b.x+","+b.y}}),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("d",e),d.style.fill="none",d.classList?d.classList.add("directionPath"+b):d.setAttribute("class","directionPath"+b);var f=a("#"+W[c[0].floor].id+" svg"),g=a(".startPin",f),h=a(".destinationPin",f);g.length?g.before(d):h.length?h.before(d):f.append(d),C=a("#"+W[c[0].floor].id+" svg .directionPath"+b),_[b].path=C}),O(0)}}function R(c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(e.endpoint=c,a("path[class^=directionPath]",V).remove(),a("#Rooms *.wayfindingRoom",V).removeAttr("class"),Z=[],Y!==c){a('#Rooms a[id="'+c+'"] g',V).attr("class","wayfindingRoom"),F(e.endpoint,d);var B,C=!1;try{B=Module.pathfinding(JSON.stringify(b),Y,c,e.accessibleRoute),1===B.size()&&(C=!0,console.error(B.get(0)))}catch(D){console.error(D.stack),console.error("Did you forget to include emscripten.pathinding.js?"),C=!0}if(!C){var E=B.get(B.size()-1);E=E.split("-");var G={type:"doors",floor:E[1],segment:E[2]};for(f=B.size()-2;f>0;f--){var H=B.get(f);if(H=H.split("-"),"path"===H[0])Z.push({type:"paths",floor:H[1],segment:H[2]});else if("portal"===H[0]){for(var I=H[0];"portal"===I;)f--,I=B.get(f).split("-")[0];f++,H=B.get(f).split("-"),Z.push({type:"portals",floor:H[1],segment:H[2]})}else console.warn("Not a path or portal"),console.warn(B.get(f))}for(j=0,f=0;f<Z.length;f++)"portals"===Z[f].type&&j++;if(_=new Array(j),_[0]=[],g={},0===Z.length)return void console.warn("Attempting to route with no solution. This should never happen. SVG likely has errors. Destination is: "+c);P(G,Z[0]);var J=b[Z[0].type][Z[0].floor][Z[0].segment];for(P(G,Z[0])?(g={},g.floor=Z[0].floor,g.type="M",g.x=J.x1,g.y=J.y1,g.length=0,_[0].push(g),g={},g.type="L",g.floor=Z[0].floor,g.x=J.x2,g.y=J.y2,g.length=J.length,_[0].push(g),_[0].routeLength=g.length):(g={},g.type="M",g.floor=Z[0].floor,g.x=J.x2,g.y=J.y2,g.length=0,_[0].push(g),g={},g.type="L",g.floor=Z[0].floor,g.x=J.x1,g.y=J.y1,g.length=J.length,_[0].push(g),_[0].routeLength=g.length),k=1,f=0;j+1>f;f++)for(h=k;h<Z.length;h++)J=b[Z[h].type][Z[h].floor][Z[h].segment],"paths"===Z[h].type&&(l=J.x1,m=J.y1,n=J.x2,o=J.y2,g={},g.floor=Z[h].floor,_[f].slice(-1)[0].x===l&&_[f].slice(-1)[0].y===m?(g.x=n,g.y=o):(g.x=l,g.y=m),g.length=J.length,g.type="L",_[f].push(g),_[f].routeLength+=g.length),"portals"===Z[h].type&&(_[f+1]=[],_[f+1].routeLength=0,P(Z[h+1],Z[h])?(g={},g.floor=Z[h].floor,g.type="M",g.x=J.x1,g.y=J.y1,g.length=0,_[f+1].push(g),_[f+1].routeLength=g.length):(g={},g.floor=Z[h].floor,g.type="M",g.x=J.x2,g.y=J.y2,g.length=0,_[f+1].push(g),_[f+1].routeLength=g.length),k=h,k++,h=Z.length);if(e.path.radius>0)for(i=0;i<_.length;i++){for(f=1;f<_[i].length-1;f++)"L"===_[i][f].type&&"L"===_[i][f].type&&(p=_[i][f-1].x-_[i][f].x,q=_[i][f-1].y-_[i][f].y,r=_[i][f].x-_[i][f+1].x,s=_[i][f].y-_[i][f+1].y,(0===q&&0===s||0===p&&0===r||p/q===r/s&&(0!==p||0!==q||0!==r||0!==s))&&(_[i][f+1].length=_[i][f].length+_[i][f+1].length,_[i].splice(f,1),f=1));for(f=1;f<_[i].length-1;f++)"L"===_[i][f].type&&"L"===_[i][f].type&&_[i][f].length>e.path.radius&&_[i][f+1].length>e.path.radius&&(t=_[i][f].x,u=_[i][f].y,v=_[i][f-1].x,w=_[i][f-1].y,_[i][f].x=Number(v)+(t-v)*((_[i][f].length-e.path.radius)/_[i][f].length),_[i][f].y=Number(w)+(u-w)*((_[i][f].length-e.path.radius)/_[i][f].length),_[i][f].length=_[i][f].length-e.path.radius,x={},x.cx=t,x.cy=u,y=_[i][f+1].x,z=_[i][f+1].y,x.x=Number(t)+(y-t)*(e.path.radius/_[i][f+1].length),x.y=Number(u)+(z-u)*(e.path.radius/_[i][f+1].length),_[i][f+1].length=_[i][f+1].length-e.path.radius,x.type="Q",x.floor=_[i][f].floor,_[i].splice(f+1,0,x))}a.each(_,function(b,c){var d,e="";a.each(c,function(a,b){switch(b.type){case"M":e="M"+b.x+","+b.y;break;case"L":e+="L"+b.x+","+b.y;break;case"Q":e+="Q"+b.cx+","+b.cy+" "+b.x+","+b.y}}),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("d",e),d.style.fill="none",d.classList?d.classList.add("directionPath"+b):d.setAttribute("class","directionPath"+b);var f=a("#"+W[c[0].floor].id+" svg"),g=a(".startPin",f),h=a(".destinationPin",f);g.length?g.before(d):h.length?h.before(d):f.append(d),A=a("#"+W[c[0].floor].id+" svg .directionPath"+b),_[b].path=A}),O(0)}}}function S(a,b){e.emscriptenBackend?R(a,b):Q(a,b)}function T(b){var c,d;for(a("#WayfindingStatus").remove(),c=0,d=0;d<W.length;d++)X===W[d].id&&(c=d);a("#"+W[c].id,b).show(),a(b).trigger("wayfinding:mapsVisible"),"function"==typeof e.endpoint?S(e.endpoint(),b):"string"==typeof e.endpoint&&S(e.endpoint,b),a.event.trigger("wayfinding:ready")}function U(b,c){var d=0;a('div:not("#WayfindingStatus")',b).remove(),a.each(W,function(e,f){var g=a('<div id="'+f.id+'"></div>');da[f.id]=e,g.load(f.path,function(a,h){"error"===h?(g.html('<p class="text-center text-danger">Map '+e+" Was not found at "+f.path+"<br />Please upload it in the administration section</p>"),W[e].el=g):(W[e].svgHandle=a,W[e].el=g,I(W[e].el),K(b,g),d+=1),d===W.length&&D(function(){E(Y,b),H(b),T(b),"function"==typeof c&&c()})})})}var V,W,X,Y,Z,$,_,aa,ba=e,ca=[],da={};return d&&"object"==typeof d&&("function"==typeof e&&(f=e),e=d,ba=d,d="initialize"),this.each(function(){if(V=a(this),G(V),d&&"string"==typeof d)switch(d){case"initialize":ba&&ba.maps?(l(V),U(V,f)):ba&&void 0!==ba.showLocation&&(e.showLocation=ba.showLocation,E(e.startpoint,V));break;case"routeTo":S(ba,V);break;case"animatePath":M(V),O(0);break;case"startpoint":void 0===ba?$=Y:(E(ba,V),e.emscriptenBackend||D(f));break;case"currentMap":void 0===ba?$=a("div:visible",V).prop("id"):L(ba,V);break;case"accessibleRoute":void 0===ba?$=e.accessibleRoute:(e.accessibleRoute=ba,e.emscriptenBackend||D(f));break;case"path":void 0===ba?$=e.path:e.path=a.extend(!0,{},e.path,ba);break;case"getDataStore":$=JSON.stringify(b);break;case"destroy":a(V).remove()}H(V)}),void 0!==$?$:this}}(jQuery),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.PriorityQueue=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;c=a("./PriorityQueue/AbstractPriorityQueue"),d=a("./PriorityQueue/ArrayStrategy"),f=a("./PriorityQueue/BinaryHeapStrategy"),e=a("./PriorityQueue/BHeapStrategy"),g=function(a){function b(a){a||(a={}),a.strategy||(a.strategy=f),a.comparator||(a.comparator=function(a,b){return(a||0)-(b||0)}),b.__super__.constructor.call(this,a)}return h(b,a),b}(c),g.ArrayStrategy=d,g.BinaryHeapStrategy=f,g.BHeapStrategy=e,b.exports=g},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(a,b){var c;b.exports=c=function(){function a(a){var b;if(null==(null!=a?a.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=a?a.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new a.strategy(a),this.length=(null!=a&&null!=(b=a.initialValues)?b.length:void 0)||0}return a.prototype.queue=function(a){this.length++,this.priv.queue(a)},a.prototype.dequeue=function(){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},a.prototype.peek=function(){if(!this.length)throw"Empty queue";return this.priv.peek()},a.prototype.clear=function(){return this.length=0,this.priv.clear()},a}()},{}],3:[function(a,b){var c,d;d=function(a,b,c){var d,e,f;for(e=0,d=a.length;d>e;)f=e+d>>>1,c(a[f],b)>=0?e=f+1:d=f;return e},b.exports=c=function(){function a(a){var b;this.options=a,this.comparator=this.options.comparator,this.data=(null!=(b=this.options.initialValues)?b.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return a.prototype.queue=function(a){var b;b=d(this.data,a,this.comparator),this.data.splice(b,0,a)},a.prototype.dequeue=function(){return this.data.pop()},a.prototype.peek=function(){return this.data[this.data.length-1]},a.prototype.clear=function(){this.data.length=0},a}()},{}],4:[function(a,b){var c;b.exports=c=function(){function a(a){var b,c,d,e,f,g,h,i,j;for(this.comparator=(null!=a?a.comparator:void 0)||function(a,b){return a-b},this.pageSize=(null!=a?a.pageSize:void 0)||512,this.length=0,i=0;1<<i<this.pageSize;)i+=1;if(1<<i!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=i,this._emptyMemoryPageTemplate=b=[],c=d=0,g=this.pageSize;g>=0?g>d:d>g;c=g>=0?++d:--d)b.push(null);if(this._memory=[],this._mask=this.pageSize-1,a.initialValues)for(h=a.initialValues,e=0,f=h.length;f>e;e++)j=h[e],this.queue(j)}return a.prototype.queue=function(a){this.length+=1,this._write(this.length,a),this._bubbleUp(this.length,a)},a.prototype.dequeue=function(){var a,b;return a=this._read(1),b=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,b),this._bubbleDown(1,b)),a},a.prototype.peek=function(){return this._read(1)},a.prototype.clear=function(){this.length=0,this._memory.length=0},a.prototype._write=function(a,b){var c;for(c=a>>this._shift;c>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[c][a&this._mask]=b},a.prototype._read=function(a){return this._memory[a>>this._shift][a&this._mask]},a.prototype._bubbleUp=function(a,b){var c,d,e,f;for(c=this.comparator;a>1&&(d=a&this._mask,a<this.pageSize||d>3?e=a&~this._mask|d>>1:2>d?(e=a-this.pageSize>>this._shift,e+=e&~(this._mask>>1),e|=this.pageSize>>1):e=a-2,f=this._read(e),!(c(f,b)<0));)this._write(e,b),this._write(a,f),a=e},a.prototype._bubbleDown=function(a,b){var c,d,e,f,g;for(g=this.comparator;a<this.length;)if(a>this._mask&&!(a&this._mask-1)?c=d=a+2:a&this.pageSize>>1?(c=(a&~this._mask)>>1,c|=a&this._mask>>1,c=c+1<<this._shift,d=c+1):(c=a+(a&this._mask),d=c+1),c!==d&&d<=this.length)if(e=this._read(c),f=this._read(d),g(e,b)<0&&g(e,f)<=0)this._write(c,b),this._write(a,e),a=c;else{if(!(g(f,b)<0))break;this._write(d,b),this._write(a,f),a=d}else{if(!(c<=this.length))break;if(e=this._read(c),!(g(e,b)<0))break;this._write(c,b),this._write(a,e),a=c}},a}()},{}],5:[function(a,b){var c;b.exports=c=function(){function a(a){var b;this.comparator=(null!=a?a.comparator:void 0)||function(a,b){return a-b},this.length=0,this.data=(null!=(b=a.initialValues)?b.slice(0):void 0)||[],this._heapify()}return a.prototype._heapify=function(){var a,b,c;if(this.data.length>0)for(a=b=1,c=this.data.length;c>=1?c>b:b>c;a=c>=1?++b:--b)this._bubbleUp(a)},a.prototype.queue=function(a){this.data.push(a),this._bubbleUp(this.data.length-1)},a.prototype.dequeue=function(){var a,b;return b=this.data[0],a=this.data.pop(),this.data.length>0&&(this.data[0]=a,this._bubbleDown(0)),b},a.prototype.peek=function(){return this.data[0]},a.prototype.clear=function(){this.length=0,this.data.length=0},a.prototype._bubbleUp=function(a){for(var b,c;a>0&&(b=a-1>>>1,this.comparator(this.data[a],this.data[b])<0);)c=this.data[b],this.data[b]=this.data[a],this.data[a]=c,a=b},a.prototype._bubbleDown=function(a){var b,c,d,e,f;for(b=this.data.length-1;c=(a<<1)+1,e=c+1,d=a,b>=c&&this.comparator(this.data[c],this.data[d])<0&&(d=c),b>=e&&this.comparator(this.data[e],this.data[d])<0&&(d=e),d!==a;)f=this.data[d],this.data[d]=this.data[a],this.data[a]=f,a=d},a}()},{}]},{},[1])(1)});